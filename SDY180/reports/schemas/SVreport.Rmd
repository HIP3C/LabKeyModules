# Abundance of plasmablasts measured by multiparameter flow cytometry in SDY180
#### Report generated by `r labkey.user.email` on `r date()`

### Summary
This report investigate the abundance of plasmablast (and other B cell subsets) over time after vaccination with Pneumovax, Fluzone, or no vaccination (saline control group). 
It can be seen on the three figures below that the plasmablast subset peaks at day 7 in both vaccine groups, with a stronger and more durable response with Pneumovax. 
As expected, there is no clear peak in the saline group. These results are similar to those reported in Figure 6 B of [Obermoser et al. (2013)](http://www.ncbi.nlm.nih.gov/pmc/articles/PMC3681204/) published as part of the original study.


```{r knitr-opts, echo = FALSE, message = FALSE, cache = FALSE}
library(knitr)
opts_chunk$set(cache=FALSE, echo=FALSE, message=FALSE, warning=FALSE,
               fig.width=10, fig.height=8, dpi=100, fig.align="center",
               cache.path=file.path("cache/reports/", labkey.user.email, ""))
```

```{r libraries, cache = FALSE}
# Load the ImmuneSpaceR package
library(ImmuneSpaceR)
library(ggplot2)
library(data.table)
library(ggthemr)
ggthemr('solarized')
```


```{r connection, cache=TRUE}
study <- CreateConnection(c("SDY180"))
dt_fcs <- study$getDataset("fcs_analyzed_result", reload=TRUE)
```

```{r data-summary, cache=TRUE, dependson="connection"}
# Subset CD19+ cells
dt_fcs19 <- dt_fcs[population_definition_reported%like%"CD19+" & arm_name%like%"Pneu"]
# Remove missing values
dt_fcs19_median <- dt_fcs19[,.(median_cell_reported=median(as.double(population_cell_number)+1,na.rm=TRUE)),by=.(study_time_collected,population_name_reported)] 
```


```{r}
# Flow cytometry vs. elispot
ggplot(dt_fcs19, aes(x=as.factor(study_time_collected), y=as.double(population_cell_number)+1))+geom_boxplot()+geom_jitter()+scale_y_log10()+facet_wrap(~population_name_reported, scale="free")+xlab("Time")+ylab(expression(paste("Number of cells/",mu,"l")))+geom_line(data=dt_fcs19_median,aes(x=as.factor(study_time_collected), y=as.double(median_cell_reported),group=1),color="black",size=1.2)+labs(title="B cell abundance after vaccination with Pneumovax")
```

```{r data-summary2, cache=TRUE, dependson="connection"}
# Subset CD19+ cells
dt_fcs19 <- dt_fcs[population_definition_reported%like%"CD19+" & arm_name%like%"Fluzone"]
# Remove missing values
dt_fcs19_median <- dt_fcs19[,.(median_cell_reported=median(as.double(population_cell_number)+1,na.rm=TRUE)),by=.(study_time_collected,population_name_reported)] 
```


```{r}
# Flow cytometry vs. elispot
ggplot(dt_fcs19, aes(x=as.factor(study_time_collected), y=as.double(population_cell_number)+1))+geom_boxplot()+geom_jitter()+scale_y_log10()+facet_wrap(~population_name_reported, scale="free")+xlab("Time")+ylab(expression(paste("Number of cells/",mu,"l")))+geom_line(data=dt_fcs19_median,aes(x=as.factor(study_time_collected), y=as.double(median_cell_reported),group=1),color="black",size=1.2)+labs(title="B cell abundance after vaccination with Fluzone")
```

```{r data-summary3, cache=TRUE, dependson="connection"}
# Subset CD19+ cells
dt_fcs19 <- dt_fcs[population_definition_reported%like%"CD19+" & arm_name%like%"Saline"]
# Remove missing values
dt_fcs19_median <- dt_fcs19[,.(median_cell_reported=median(as.double(population_cell_number)+1,na.rm=TRUE)),by=.(study_time_collected,population_name_reported)] 
```


```{r}
# Flow cytometry vs. elispot
ggplot(dt_fcs19, aes(x=as.factor(study_time_collected), y=as.double(population_cell_number)+1))+geom_boxplot()+geom_jitter()+scale_y_log10()+facet_wrap(~population_name_reported, scale="free")+xlab("Time")+ylab(expression(paste("Number of cells/",mu,"l")))+geom_line(data=dt_fcs19_median,aes(x=as.factor(study_time_collected), y=as.double(median_cell_reported),group=1),color="black",size=1.2)+labs(title="B cell abundance without vaccination (Saline group)")
```
