```{r knitr-opts, echo = FALSE}
library(knitr)
opts_chunk$set(message = FALSE)
opts_chunk$set(cache = FALSE, cache.path = file.path(labkey.file.root, "cache/GeneSetEnrichmentAnalysis/"))
```

### Display
- List of enriched pathways
- Heatmap of pathway vs time

```{r lib, cache = FALSE, message = FALSE, echo = FALSE}
library(ImmuneSpaceR)
library(Biobase)
library(GSEABase)
```

```{r luparam}
print(labkey.url.params)
```

```{r get}
# labkey.url.base <- "https://www.immunespace.org"
# labkey.url.base <- "www.immunespace.org"
# labkey.url.path <- "Studies/SDY269"
# labkey.user.email <- "rsautera at fhcrc.org"
 cohort <- "LAIV_2008"
 idxfile = "/home/rsautera/workspace/others/hipcdb/sets_indices_TIV0809.rds"
con <- CreateConnection("SDY269")
EM <- con$getGEMatrix(cohort)
indices <- readRDS( idxfile )
mm <- model.matrix(~subject_accession + study_time_collected, EM)
res <- camera(EM, indices, design = mm, sort = FALSE)
```

```{r kable-LAIV, results='asis'}
kable(res[res$FDR<.2, ], format='html', row.names=FALSE, table.attr='id="res_table"')
```

<!--
cont.matrix <- makeContrast(paste0("study_time_collected", c(3,7)), levels = mm)
res.dt <- data.table(res)
res.dt <- res.dt[, Pval := ifelse(Direction == "Up", 10*log10(PValue), -10*log10(PValue))]
mat <- 
-->

