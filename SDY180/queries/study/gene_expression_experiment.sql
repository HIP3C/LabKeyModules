SELECT DISTINCT biosample.subject_accession, 
biosample.study_time_collected AS Sequencenum, 
COALESCE(expression_matrix_2_biosample_imported_list.biosample_accession)||'_'||COALESCE(expression_matrix_2_biosample_imported_list.expression_matrix_accession)||'_'||COALESCE(reagents.reagent_accession) as matrix_key,
expression_matrix_2_biosample_imported_list.biosample_accession, 
expression_matrix_2_biosample_imported_list.file_info_name,
expression_matrix_2_biosample_imported_list.expression_matrix_accession,
arm_or_cohort.name as arm_name,
reagents.reagent_name,
reagents.reagent_manufacturer,
reagents.reagent_description,
platforms.file_info_name as feature_mapping_file,
trt.name as treatment,
ptl.name as protocol
FROM lists.expression_matrix_2_biosample_imported_list, 
immport.biosample, 
lists.gene_expression_reagents_2_matrix r2m,
lists.gene_expression_platforms platforms,
lists.gene_expression_reagents reagents,
immport.arm_or_cohort,
cohort_membership,
immport.biosample_2_expsample bs2es,
immport.expsample_2_treatment es2trt,
immport.treatment trt,
immport.biosample_2_protocol bs2ptl,
immport.protocol ptl
WHERE biosample.biosample_accession=expression_matrix_2_biosample_imported_list.biosample_accession
AND expression_matrix_2_biosample_imported_list.expression_matrix_accession=r2m.expression_matrix_accession
and r2m.reagent_accession=reagents.reagent_accession
AND biosample.subject_accession=cohort_membership.subject_accession
AND cohort_membership.arm_accession=arm_or_cohort.arm_accession
AND platforms.reagent_accession=reagents.reagent_accession
AND biosample.biosample_accession = bs2es.biosample_accession
AND bs2es.expsample_accession = es2trt.expsample_accession
AND es2trt.treatment_accession = trt.treatment_accession
AND biosample.biosample_accession = bs2ptl.biosample_accession
AND bs2ptl.protocol_accession = ptl.protocol_accession
